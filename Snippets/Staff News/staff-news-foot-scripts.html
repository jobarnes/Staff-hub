<script>

function pagescript(){
// add the bootstrap classes for style
  $('.newnews input[type=text]').addClass('form-control');
  $('.newnews select').addClass('form-control');
  $('.newnews textarea').addClass('form-control');
// set defaults
  $('#metadata_field_text_975124_value').attr('maxlength','500');
  $('#metadata_field_text_975129_value').attr('maxlength','50');
  $('#page_standard_0_378').attr('maxlength','75');
  $('.whatson').hide();
  $('.training').hide();
  $('.grants').hide();
  $('.study').hide();
  $('.corporate').show();
// organise the issue selector area
  $('.dest label:first-of-type').append(' : (Next Issue)');
  $('.dest label:nth-of-type(3n)').append('<br>');
  $('.dest label:nth-of-type(3n+1)').append(' : News of Interest');

// changes between whats on and others  
$('#metadata_field_select_975143').change(function(){
  var sel = $('#metadata_field_select_975143 option:selected').val();
  if (sel=="Corporate Announcement") {
    $('.training').hide();
    $('.grants').hide();
    $('.study').hide();
    $('.whatson').hide();
    $('.corporate').show();
  }
  if (sel=="Training and Development") {
    $('.corporate').hide();
    $('.grants').hide();
    $('.study').hide();
    $('.whatson').hide();
    $('.training').show();
  }
  if (sel=="Grants and Funding") {
    $('.training').hide();
    $('.corporate').hide();
    $('.study').hide();
    $('.whatson').hide();
    $('.grants').show();
  }
  if (sel=="Study Participants") {
    $('.corporate').hide();
    $('.grants').hide();
    $('.training').hide();
    $('.whatson').hide();
    $('.study').show();
  }
  if (sel=="Whats on") {
    $('#metadata_field_text_975124_value').attr('rows','4');
    $('#metadata_field_text_975124_value').attr('maxlength','250');
    $('#count_975124').text('200');
    $('.whatson').show();
    $('.corporate').hide();
    $('.grants').hide();
    $('.training').hide();
    $('.study').hide();
  }else{
    $('#metadata_field_text_975124_value').attr('rows','7');
    $('#metadata_field_text_975124_value').attr('maxlength','500');
    $('#count_975124').text('500');
  }
});

// defaults for new issue folder form
var thisNum = $("#last-issue").text();
thisNum++;
$('#folder_0_210').val(thisNum);
var lastDate = $("#last-issue-date").text();
var thisDate = moment(lastDate, "DD-MMM").add('days', 7).format("D MMMM YYYY");
var thisClose = moment(lastDate, "DD-MMM").add('days', 5).format("D MMMM YYYY");
$('#metadata_field_text_1020784_value').val(thisDate);
$('#metadata_field_text_1020785_value').val(thisClose);


// autolinks URLs in stories
var myTextEl = document.getElementById( 'sn-story-listing' );
myTextEl.innerHTML = Autolinker.link( myTextEl.innerHTML, { newWindow: false } );

// ** end of onload scripts
}

// Input Previewer

$('#page_asset_builder_975087 *').keyup(function(){
  updatePreview();
});
$('#page_asset_builder_975087 select').change(function(){
  updatePreview();
});
function updatePreview(){
  var pretype = $('#metadata_field_select_975143 option:selected').val();
  var pretitle = $('#page_standard_0_378').val();
  var precontent = $('#metadata_field_text_975124_value').val();
  var predate = $('#metadata_field_text_975126_value').val();
  if (predate) {
    predate = " "+predate+".";
  }
  var preevent = " "+$('#metadata_field_text_975129_value').val();
  var prehrec = " "+$('#metadata_field_text_975078_value').val();
  var prepres = " "+$('#metadata_field_text_975072_value').val();
  var prevenue = " "+$('#metadata_field_text_975117_value').val();
  var precontact1 = $('#metadata_field_text_975128_value').val();
  if (precontact1) {
    precontact1 = " "+$('#metadata_field_select_975125 option:selected').val()+" "+precontact1+".";
  }
  var precontact2 = $('#metadata_field_text_975130_value').val();
  if (precontact2) {
    precontact2 = " "+$('#metadata_field_select_975116 option:selected').val()+" "+precontact2+".";
  }
  var presource = $('#metadata_field_text_975077_value').val();
  if (presource) {
    presource = "<br>[Source: "+presource+"]";
  }
  var prenotes = "<br><br>"+$('#metadata_field_text_1040446_value').val();

  $('#preview').addClass("well");
  $('#preview').html(pretype+"<h3>"+pretitle+"</h3>"+precontent+predate+preevent+prehrec+prepres+prevenue+precontact1+precontact2+presource+prenotes);
}

// Character counter
CharacterCount = function(TextArea,FieldToCount){
  var myField = document.getElementById(TextArea);
  var myLabel = document.getElementById(FieldToCount); 
  if(!myField || !myLabel){return false}; // catches errors
  var MaxChars =  myField.maxLength;
  if(!MaxChars){MaxChars =  myField.getAttribute('maxlength') ; }; if(!MaxChars){return false};
  var remainingChars =   MaxChars - myField.value.length;
  myLabel.innerHTML = remainingChars;
}
// Character counter setup!!
setInterval(function(){CharacterCount('page_standard_0_378','count_name')},55);
setInterval(function(){CharacterCount('metadata_field_text_975129_value','count_975129')},55);
setInterval(function(){CharacterCount('metadata_field_text_975124_value','count_975124')},55);

// ** auto populate text fields
$('.help-block i').css('cursor','pointer');
$('.help-block i').click(function() {
  var text = $( this ).attr('title');
  $(this).parent().prev().val( text );
  updatePreview();
});
</script>

<script src="./?a=1020990"></script> <!-- moment.js -->
<script src="./?a=1045847"></script> <!-- autolinker.js -->
<!-- <script src="./?a=1017142"></script>combined and minified scripts -->

<script>
jQuery(document).ready(function($){
    pagescript(); // call a function for anything unique to the page
});
</script>